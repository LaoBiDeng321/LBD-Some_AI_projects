<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简网页抽奖工具 Pro+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* 丝滑移动动画 */
        .smooth-move {
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* 隐藏滚动条 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 悬浮动画 */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        /* --- 新增：速度感特效 --- */
        .speed-blur {
            /* 垂直方向模糊，模拟滚屏 */
            filter: blur(0px);
            animation: motionBlur 0.1s infinite;
            color: #4f46e5; /* 滚动时变色 */
        }
        
        @keyframes motionBlur {
            0% { filter: blur(0px) scale(1); opacity: 1; transform: translateY(0); }
            50% { filter: blur(2px) scale(1.05); opacity: 0.8; transform: translateY(-2px); }
            100% { filter: blur(0px) scale(1); opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden font-sans selection:bg-indigo-100 selection:text-indigo-700">

<div id="app" class="h-full flex relative">
    
    <aside class="bg-white/80 backdrop-blur-md shadow-[4px_0_24px_rgba(0,0,0,0.02)] flex flex-col z-40 transition-all duration-500 border-r border-slate-100"
           :class="isSidebarOpen ? 'w-80 translate-x-0' : 'w-0 -translate-x-full opacity-0 overflow-hidden'">
        
        <div class="p-5 flex justify-between items-center border-b border-slate-100">
            <h2 class="font-bold text-lg text-slate-700 tracking-tight flex items-center">
                <i class="fas fa-history text-indigo-500 mr-2"></i>历史记录
            </h2>
            <div class="flex space-x-2">
                <button @click="clearAllHistory" v-if="historyList.length > 0" title="清空所有记录" class="text-slate-400 hover:text-red-500 transition px-2">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button @click="isSidebarOpen = false" class="text-slate-400 hover:text-slate-600 transition px-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="flex-1 overflow-y-auto no-scrollbar px-3 pb-4 pt-3">
                    <div v-if="historyList.length === 0" class="text-slate-400 text-center mt-10 text-sm py-8 border-2 border-dashed border-slate-200 rounded-2xl">
                        暂无记录
                    </div>
                    
                    <div v-for="(item, index) in historyList" :key="index" class="mb-3 group">
                        <div class="bg-white border border-slate-100 rounded-2xl hover:shadow-md hover:border-indigo-100 transition-all duration-300 overflow-hidden relative">
                            <div @click="toggleHistoryItem(index)" class="p-3 cursor-pointer flex justify-between items-start relative z-10">
                                <div class="flex-1 pr-2">
                                    <h4 class="font-bold text-slate-700 text-sm leading-tight mb-1 line-clamp-2" :title="item.rawName">
                                        {{ item.displayName }}
                                    </h4>
                                    <span class="text-[10px] text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded">{{ item.date }} {{ item.timeDisplay }}</span>
                                </div>
                                
                                <div class="flex space-x-1">
                                    <button @click.stop="editHistoryName(index)" class="text-slate-300 hover:text-indigo-500 transition p-1">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button @click.stop="deleteHistoryItem(index)" class="text-slate-300 hover:text-red-500 transition p-1">
                                        <i class="fas fa-trash-can"></i>
                                    </button>
                                </div>
                            </div>

                            <div v-show="item.expanded" class="bg-slate-50 px-3 py-2 text-sm border-t border-slate-100">
                                <div class="text-slate-500 mb-2 text-xs flex justify-between">
                                    <span>共 {{ item.data.length }} 人</span>
                                </div>
                                <button @click="loadHistory(item)" class="w-full bg-indigo-600 text-white py-2 rounded-xl text-xs font-bold hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200 flex items-center justify-center">
                                    <i class="fas fa-upload mr-1"></i> 使用此名单
                                </button>
                            </div>
                            
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        </div>
                    </div>
                </div>
    </aside>

    <button v-if="!isSidebarOpen" @click="isSidebarOpen = true" class="absolute left-6 top-6 z-30 bg-white/90 backdrop-blur p-3 rounded-2xl shadow-lg text-indigo-600 hover:scale-110 transition-all duration-300">
        <i class="fas fa-bars"></i>
    </button>

    <main class="flex-1 relative w-full h-full flex flex-col overflow-hidden bg-slate-50" :class="isSidebarOpen ? 'ml-80' : ''">
        
        <div class="absolute top-6 right-6 z-30">
            <button @click="showSettings = !showSettings" class="bg-white/90 backdrop-blur p-3 rounded-2xl shadow-lg text-slate-600 hover:text-indigo-600 hover:rotate-90 transition-all duration-500">
                <i class="fas fa-cog text-xl"></i>
            </button>
            <div v-if="showSettings" class="absolute right-0 mt-3 w-64 bg-white rounded-3xl shadow-2xl border border-slate-100 p-5 z-40 origin-top-right transition-all">
                <h3 class="font-bold text-slate-700 mb-3 text-lg">设置</h3>
                <label class="flex items-center space-x-3 cursor-pointer group">
                    <div class="relative">
                        <input type="checkbox" v-model="settings.skipHeader" class="peer sr-only">
                        <div class="w-10 h-6 bg-slate-200 rounded-full peer peer-checked:bg-indigo-500 transition-all"></div>
                        <div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-all peer-checked:translate-x-4"></div>
                    </div>
                    <span class="text-sm text-slate-600 group-hover:text-slate-900">表格数据跳过首行</span>
                </label>
            </div>
        </div>

        <div class="absolute z-20 smooth-move" :class="inputBoxClasses">
            
            <h1 class="text-5xl font-black text-center text-slate-800 mb-10 tracking-tight transition-opacity duration-500"
                :class="mode === 'input' ? 'opacity-100' : 'opacity-0 h-0 overflow-hidden mb-0'">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-600">LUCKY</span> DRAW
            </h1>

            <div class="relative group bg-white rounded-3xl shadow-[0_20px_50px_-12px_rgba(0,0,0,0.1)] transition-all duration-500 border border-white"
                 :class="mode === 'input' ? 'w-[600px] hover:shadow-[0_20px_60px_-12px_rgba(79,70,229,0.15)] hover:scale-[1.01]' : 'w-[320px] shadow-sm bg-opacity-90'">
                
                <div class="flex items-center p-2">
                    <label class="cursor-pointer bg-slate-50 hover:bg-slate-100 text-slate-600 px-4 py-3 rounded-2xl transition-colors duration-300 flex items-center shrink-0">
                        <i class="fas fa-folder-open text-indigo-500 mr-2"></i>
                        <span class="text-sm font-medium hidden sm:inline" v-if="mode === 'input'">导入</span>
                        <input type="file" class="hidden" accept=".xlsx, .xls, .csv, .txt" @change="handleFileUpload">
                    </label>
                    
                    <div class="w-px h-6 bg-slate-200 mx-2"></div>
                    
                    <input type="text" 
                           v-model="inputText" 
                           @keyup.enter="processInputData"
                           class="flex-1 bg-transparent px-2 py-2 outline-none text-slate-700 placeholder:text-slate-400"
                           :placeholder="mode === 'input' ? '输入名单 (空格/逗号) ...' : '输入名字追加到当前...'">
                    
                    <button @click="processInputData" 
                            class="text-white w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-300 shadow-lg active:scale-90 shrink-0"
                            :class="mode === 'input' ? 'bg-indigo-600 hover:bg-indigo-700 shadow-indigo-200' : 'bg-emerald-500 hover:bg-emerald-600 shadow-emerald-200'">
                        <i class="fas" :class="mode === 'input' ? 'fa-arrow-right' : 'fa-plus'"></i>
                    </button>
                </div>
            </div>
            
            <div class="mt-4 text-center transition-opacity duration-500"
                 :class="mode === 'input' ? 'opacity-100' : 'opacity-0 hidden'">
                <ul class="text-xs text-slate-400 max-w-md mx-auto text-left space-y-1">
                    <li class="font-bold text-slate-600">使用说明：</li>
                    <li>• 支持导入 .xlsx .csv .txt 文件</li>
                    <li>• 自动识别 GBK/UTF-8 编码</li>
                    <li>• 手动输入支持空格、逗号、分号分隔</li>
                    <li>• 可修改历史记录名称</li>
                    <li>• 删除所有记录后自动返回初始状态</li>
                    <li>• 后续可添加更多名单但暂不支持删除</li>
                </ul>
            </div>
        </div>

        <div v-if="mode === 'lottery'" class="absolute inset-0 z-10 flex flex-col items-center justify-center pointer-events-none">
            
            <div class="absolute inset-0 flex justify-center items-center opacity-[0.03]">
                <i class="fas fa-gift text-[40vh]"></i>
            </div>

            <div class="pointer-events-auto text-center animate-float">
                <div class="text-slate-500 mb-6 font-medium tracking-widest uppercase text-sm bg-white/50 px-4 py-1 rounded-full inline-block backdrop-blur">
                    当前奖池: <span class="text-indigo-600 font-bold text-lg">{{ currentCandidates.length }}</span> 人
                </div>
                
                <div class="bg-white/80 backdrop-blur-xl rounded-[2.5rem] shadow-[0_30px_80px_-20px_rgba(79,70,229,0.3)] w-[90vw] max-w-lg h-64 flex items-center justify-center border-4 border-white mb-10 transition-all duration-200 relative overflow-hidden"
                     :class="isRunning ? 'scale-105 shadow-indigo-400/30 ring-4 ring-indigo-100' : 'scale-100'">
                    
                    <div v-if="isRunning" class="absolute inset-x-0 top-0 h-16 bg-gradient-to-b from-white via-white/80 to-transparent z-10"></div>
                    <div v-if="isRunning" class="absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-white via-white/80 to-transparent z-10"></div>

                    <span class="text-6xl md:text-7xl font-black text-slate-800 tracking-tight break-all line-clamp-2 px-4 transition-all"
                          :class="isRunning ? 'speed-blur' : ''">
                        {{ displayCandidate }}
                    </span>
                </div>

                <button @click="toggleLottery" 
                        class="group relative px-16 py-5 rounded-full text-xl font-bold text-white shadow-2xl transition-all duration-300 hover:-translate-y-1 active:translate-y-0 focus:outline-none overflow-hidden"
                        :class="isRunning ? 'bg-rose-500 shadow-rose-300' : 'bg-indigo-600 shadow-indigo-300'">
                    
                    <div class="absolute top-0 left-0 w-full h-full bg-white/20 -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-in-out"></div>
                    
                    <span class="relative flex items-center">
                        <i class="fas mr-3" :class="isRunning ? 'fa-stop' : 'fa-play'"></i>
                        {{ isRunning ? '停 止' : '开始抽奖' }}
                    </span>
                </button>
            </div>

            <div class="absolute bottom-10 w-full max-w-4xl px-6 pointer-events-auto">
                <div v-if="currentWinners.length > 0" class="bg-white/60 backdrop-blur-md rounded-3xl p-6 shadow-lg border border-white/50">
                    <h3 class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-4 flex items-center">
                        <i class="fas fa-trophy text-yellow-500 mr-2"></i> 本轮幸运儿
                    </h3>
                    <div class="flex flex-wrap gap-3 max-h-32 overflow-y-auto no-scrollbar">
                        <span v-for="(winner, idx) in currentWinners" :key="idx" 
                              class="bg-white text-indigo-900 px-5 py-2 rounded-2xl text-sm font-bold shadow-sm border border-slate-100 flex items-center animate-[bounce_0.5s_ease-out]">
                            {{ winner }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <div v-if="toast.show" class="fixed top-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center transition-all animate-[bounce_0.5s_ease-out]">
            <i class="fas fa-check-circle text-emerald-400 mr-2"></i>
            {{ toast.message }}
        </div>

        <div v-if="showEditModal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl">
                <h3 class="text-2xl font-bold text-slate-800 mb-6">修改记录名称</h3>
                <input type="text" v-model="editName" class="w-full px-4 py-3 border border-slate-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent mb-6" placeholder="输入新名称">
                <div class="grid grid-cols-2 gap-4">
                    <button @click="cancelEdit" class="px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-2xl">取消</button>
                    <button @click="saveEdit" class="px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-2xl shadow-lg shadow-indigo-200">保存</button>
                </div>
            </div>
        </div>

    </main>

    <div v-if="showHeaderModal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl">
            <h3 class="text-2xl font-bold text-slate-800 mb-2">数据格式确认</h3>
            <p class="text-slate-500 mb-6">检测到表格数据。第一行是标题（表头）吗？</p>
            
            <div class="mb-8 flex items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                <input type="checkbox" id="rememberChoice" v-model="tempRememberChoice" class="w-5 h-5 text-indigo-600 rounded">
                <label for="rememberChoice" class="ml-3 text-sm text-slate-600 font-medium">记住我的选择</label>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button @click="handleHeaderChoice(false)" class="px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-2xl">包含第一行</button>
                <button @click="handleHeaderChoice(true)" class="px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-2xl shadow-lg shadow-indigo-200">跳过第一行</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- 状态 ---
            const mode = ref('input'); 
            const isSidebarOpen = ref(true);
            const showSettings = ref(false);
            const inputText = ref('');
            
            const currentCandidates = ref([]); 
            const originalData = ref([]);      
            const currentWinners = ref([]);    
            const historyList = ref([]);       
            
            const isRunning = ref(false);
            const displayCandidate = ref('???');
            let timer = null;

            const showHeaderModal = ref(false);
            const tempFileEvent = ref(null);
            const tempRememberChoice = ref(false);
            const settings = reactive({ skipHeader: false, hasSetPreference: false });
            
            // 编辑记录名称相关状态
            const showEditModal = ref(false);
            const editName = ref('');
            const editIndex = ref(-1);
            
            // Toast 状态
            const toast = reactive({ show: false, message: '' });

            const inputBoxClasses = computed(() => {
                if (mode.value === 'input') {
                    return 'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2';
                } else {
                    return 'top-6 left-1/2 -translate-x-1/2 translate-y-0';
                }
            });

            // --- 生命周期 ---
            onMounted(() => {
                const savedSettings = localStorage.getItem('lottery_settings');
                if (savedSettings) Object.assign(settings, JSON.parse(savedSettings));
                
                const savedHistory = localStorage.getItem('lottery_history');
                if (savedHistory) historyList.value = JSON.parse(savedHistory);

                if (window.innerWidth < 1024) isSidebarOpen.value = false;
            });

            watch(settings, (v) => localStorage.setItem('lottery_settings', JSON.stringify(v)), { deep: true });
            watch(historyList, (v) => localStorage.setItem('lottery_history', JSON.stringify(v)), { deep: true });

            // --- 辅助函数：显示Toast ---
            const showToast = (msg) => {
                toast.message = msg;
                toast.show = true;
                setTimeout(() => toast.show = false, 3000);
            };

            // --- 辅助函数：生成可读的名称 ---
            const generateName = (list, fileName) => {
                // 如果是文件导入，优先用文件名，但加上预览
                // 如果是手动输入，直接用名单前几位
                const preview = list.slice(0, 3).join(', ');
                const suffix = list.length > 3 ? `... 等${list.length}人` : '';
                return `${preview}${suffix}`;
            };

            // --- 逻辑 ---

            const processInputData = () => {
                if (!inputText.value.trim()) return;
                const rawList = inputText.value.split(/[ ,;，；\n]+/).filter(item => item.trim() !== '');
                
                if (rawList.length > 0) {
                    if (mode.value === 'input') {
                        // 初始模式：创建新列表
                        initializeLottery(rawList, null); // null 表示手动输入，后续生成名称
                    } else {
                        // 抽奖模式：追加数据
                        appendData(rawList);
                    }
                    inputText.value = '';
                }
            };

            const appendData = (newData) => {
                currentCandidates.value.push(...newData);
                // 可选：是否也添加到原始数据备份中？这里选择添加
                originalData.value.push(...newData);
                showToast(`成功添加 ${newData.length} 人到当前列表`);
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (settings.hasSetPreference) {
                    readFile(file, settings.skipHeader);
                } else {
                    tempFileEvent.value = file;
                    showHeaderModal.value = true;
                }
                e.target.value = '';
            };

            const handleHeaderChoice = (isHeader) => {
                if (tempRememberChoice.value) {
                    settings.skipHeader = isHeader;
                    settings.hasSetPreference = true;
                }
                readFile(tempFileEvent.value, isHeader);
                showHeaderModal.value = false;
                tempFileEvent.value = null;
                tempRememberChoice.value = false;
            };

            const readFile = (file, skipHeader) => {
                const name = file.name.toLowerCase();
                if (name.endsWith('.csv') || name.endsWith('.txt')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const decoder = new TextDecoder('gbk'); 
                        const text = decoder.decode(e.target.result);
                        const workbook = XLSX.read(text, { type: 'string' });
                        processWorkbook(workbook, skipHeader, file.name);
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        processWorkbook(workbook, skipHeader, file.name);
                    };
                    reader.readAsArrayBuffer(file);
                }
            };

            const processWorkbook = (workbook, skipHeader, fileName) => {
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                let flatList = [];
                let startIndex = skipHeader ? 1 : 0;

                for (let i = startIndex; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row && row.length > 0) {
                        row.forEach(c => {
                            if (c != null && String(c).trim() !== '') flatList.push(String(c).trim());
                        });
                    }
                }

                if (flatList.length > 0) {
                    if (mode.value === 'input') {
                        initializeLottery(flatList, fileName); 
                    } else {
                        appendData(flatList); // 抽奖模式下上传也是追加
                    }
                } else {
                    alert("文件无效");
                }
            };

            const initializeLottery = (list, fileName) => {
                originalData.value = [...list];
                currentCandidates.value = [...list];
                currentWinners.value = [];
                displayCandidate.value = "准备就绪";
                mode.value = 'lottery'; 
                addToHistory(list, fileName);
            };

            // --- 历史记录管理 ---

            const addToHistory = (data, fileName) => {
                const now = new Date();
                const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                // 生成智能名称
                const displayName = generateName(data);

                // 去重逻辑：如果名字和数量完全一致，则不添加（或者只更新时间）
                const existsIdx = historyList.value.findIndex(h => h.displayName === displayName && h.data.length === data.length);
                
                const newItem = {
                    displayName: displayName, // 比如 "张三, 李四..."
                    rawName: fileName || '手动输入', // 原始文件名备用
                    date: now.toLocaleDateString(),
                    timeDisplay: timeStr,
                    data: data,
                    winners: [],
                    expanded: false
                };

                if (existsIdx > -1) {
                    historyList.value.splice(existsIdx, 1); // 移到最前
                }
                historyList.value.unshift(newItem);
            };

            const deleteHistoryItem = (index) => {
                if (confirm('确定删除这条记录吗？')) {
                    historyList.value.splice(index, 1);
                    // 删除记录后返回初始状态
                    if (historyList.value.length === 0) {
                        currentCandidates.value = [];
                        originalData.value = [];
                        currentWinners.value = [];
                        displayCandidate.value = '???';
                        mode.value = 'input';
                    }
                }
            };

            const clearAllHistory = () => {
                if (confirm('确定清空所有历史记录吗？此操作不可恢复。')) {
                    historyList.value = [];
                    // 清空记录后返回初始状态
                    currentCandidates.value = [];
                    originalData.value = [];
                    currentWinners.value = [];
                    displayCandidate.value = '???';
                    mode.value = 'input';
                }
            };

            const loadHistory = (historyItem) => {
                initializeLottery(historyItem.data, historyItem.rawName);
            };

            const toggleHistoryItem = (index) => {
                historyList.value[index].expanded = !historyList.value[index].expanded;
            };

            // --- 编辑历史记录名称 ---

            const editHistoryName = (index) => {
                editIndex.value = index;
                editName.value = historyList.value[index].displayName;
                showEditModal.value = true;
            };

            const saveEdit = () => {
                if (editName.value.trim() && editIndex.value > -1) {
                    historyList.value[editIndex.value].displayName = editName.value.trim();
                    showEditModal.value = false;
                    showToast('记录名称已更新');
                }
            };

            const cancelEdit = () => {
                showEditModal.value = false;
                editIndex.value = -1;
                editName.value = '';
            };

            // --- 抽奖核心 ---

            const toggleLottery = () => {
                if (isRunning.value) stopLottery();
                else startLottery();
            };

            const startLottery = () => {
                if (currentCandidates.value.length === 0) {
                    alert("奖池已空！请添加人员。");
                    return;
                }
                isRunning.value = true;
                // 30ms 极速刷新，配合 CSS 模糊产生速度感
                timer = setInterval(() => {
                    const randomIndex = Math.floor(Math.random() * currentCandidates.value.length);
                    displayCandidate.value = currentCandidates.value[randomIndex];
                }, 30);
            };

            const stopLottery = () => {
                clearInterval(timer);
                isRunning.value = false;
                const winnerIndex = Math.floor(Math.random() * currentCandidates.value.length);
                const winner = currentCandidates.value[winnerIndex];
                
                displayCandidate.value = winner;
                currentWinners.value.push(winner);
                currentCandidates.value.splice(winnerIndex, 1);
            };

            return {
                mode,
                isSidebarOpen,
                showSettings,
                settings,
                inputText,
                displayCandidate,
                isRunning,
                currentWinners,
                historyList,
                processInputData,
                handleFileUpload,
                showHeaderModal,
                handleHeaderChoice,
                tempRememberChoice,
                toggleLottery,
                toggleHistoryItem,
                loadHistory,
                currentCandidates,
                inputBoxClasses,
                deleteHistoryItem,
                clearAllHistory,
                toast,
                showEditModal,
                editName,
                editHistoryName,
                saveEdit,
                cancelEdit
            };
        }
    }).mount('#app');
</script>
</body>
</html>